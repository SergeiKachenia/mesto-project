(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){"Escape"===e.key&&o()}function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",t)}function o(){var e=document.querySelector(".popup_opened");e&&(e.classList.remove("popup_opened"),document.removeEventListener("keydown",t))}function r(e){e.target.classList.contains("popup_opened")&&(o(),e.stopPropagation())}e.d({},{C:()=>Q}),document.querySelectorAll(".popup");var c={baseUrl:"https://nomoreparties.co/v1/plus-cohort-4",headers:{authorization:"0097a37e-2eb2-4a07-8e8c-4ee3c30b05f9","Content-Type":"application/json"}},a=function(e){return e.ok?e.json():Promise.reject("Ошибка здесь: ".concat(e.status))},u=document.querySelector(".popup_type_photo"),l=u.querySelector(".popup__caption"),i=u.querySelector(".popup__image"),s=document.querySelector(".cards-template").content;function p(e,t){var o=s.querySelector(".element").cloneNode(!0),r=o.querySelector(".element__image"),p=o.querySelector(".element__title"),d=o.querySelector(".element__likes-counter"),f=o.querySelector(".element__like-button"),_=o.querySelector(".element__delete-button");return r.src=e.link,r.alt=e.name,p.textContent=e.name,function(e,t,n){t.owner._id!==n._id&&e.classList.add("element__delete-button_hidden")}(_,e,t),e.likes.length>0&&(d.textContent=e.likes.length,e.likes.some((function(e){return e._id===t._id}))&&f.classList.add("element__like-button_active")),o.setAttribute("data-id",e._id),f.addEventListener("click",(function(t){return function(e,t,n){var o,r=t._id;e.target.classList.contains("element__like-button_active")?(o=r,fetch("".concat(c.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:c.headers}).then(a)).then((function(t){e.target.classList.remove("element__like-button_active"),t.likes.length>0?n.textContent=t.likes.length:n.textContent=""})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then(a)}(r).then((function(t){n.textContent=t.likes.length,e.target.classList.add("element__like-button_active")})).catch((function(e){console.log(e)}))}(t,e,d)})),_.addEventListener("click",(function(e){return Q(e)})),r.addEventListener("click",(function(){return function(e){i.src=e.link,i.alt=e.name,l.textContent=e.name,n(u)}(e)})),o}var d=function(e,t,n){var o=f(e,t);e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},f=function(e,t){return t.querySelector(".".concat(e.id,"-error"))},_=function(e,t){!function(e){return e.every((function(e){return e.validity.valid}))}(t)?e.disabled=!0:e.disabled=!1},y=function(e,t,n){e.forEach((function(o){var r=Array.from(e),c=t.querySelector(n.submitButtonSelector);d(o,t,n),_(c,r)}))};function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var v,h=document.querySelector(".content"),S=document.querySelectorAll(".popup"),b=h.querySelectorAll(".popup__close-button"),q=h.querySelector(".elements"),g=h.querySelector(".popup_type_profile"),k=h.querySelector(".popup_type_place"),E=h.querySelector(".popup_type_avatar"),C=h.querySelector(".popup_type_delete-card"),L=h.querySelector(".popup__form_type_edit"),A=h.querySelector(".popup__form_type_add"),x=h.querySelector(".popup__form_type_avatar"),w=h.querySelector(".popup__field_content_name"),U=h.querySelector(".popup__field_content_description"),O=h.querySelector(".profile__name"),P=h.querySelector(".profile__description"),j=h.querySelector(".profile__avatar"),T=h.querySelector(".popup__field_content_placename"),D=h.querySelector(".popup__field_content_link"),N=h.querySelector(".popup__field_content_avatar"),B=h.querySelectorAll(".popup__edit-profile-input"),I=h.querySelectorAll(".popup__new-place-input"),J=h.querySelectorAll(".popup__new-avatar-input"),H=h.querySelector(".popup__profile-save-button"),M=h.querySelector(".popup__new-place-create-button"),z=h.querySelector(".popup__new-avatar-save-button"),$=h.querySelector(".popup__delete-card-button"),F={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__submit-button",inputErrorClass:"popup__field_type_error",errorClass:"popup__input-error_active"};function G(e,t,n){O.textContent=e,P.textContent=t,j.src=n}function K(e){q.prepend(e)}function Q(e){n(C);var t=e.target.closest(".element").getAttribute("data-id");C.setAttribute("data-id",t)}Promise.all([fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then(a),fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then(a)]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(o=n.next()).done)&&(c.push(o.value),!t||c.length!==t);a=!0);}catch(e){u=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw r}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];r.forEach((function(e){K(p(e,c)),G(c.name,c.about,c.avatar),v=c}))})).catch((function(e){console.log(e)})),$.addEventListener("click",(function(){var e,t=C.getAttribute("data-id"),n=document.querySelector("[data-id='".concat(t,"']"));$.textContent="Удаляем...",(e=t,fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers}).then(a)).then((function(){n.remove(),o()})).catch((function(e){console.log(e)})).finally((function(){$.textContent="Да"}))})),L.addEventListener("submit",(function(e){var t;e.preventDefault(),H.textContent="Сохраняем...",(t={name:w.value,about:U.value},fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t.name,about:t.about})}).then(a)).then((function(e){G(e.name,e.about,e.avatar),o()})).catch((function(e){console.log(e)})).finally((function(){H.textContent="Сохранить"}))})),A.addEventListener("submit",(function(e){var t;e.preventDefault(),M.textContent="Добавляем...",(t={name:T.value,link:D.value},fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:t.name,link:t.link})}).then(a)).then((function(e){K(p(e,v)),A.reset(),o()})).catch((function(e){console.log(e)})).finally((function(){M.textContent="Добавить"}))})),x.addEventListener("submit",(function(e){var t;e.preventDefault(),z.textContent="Сохраняем...",(t=N.value,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:t})}).then(a)).then((function(e){j.src=e.avatar,x.reset(),o()})).catch((function(e){console.log(e)})).finally((function(){z.textContent="Сохранить"}))})),b.forEach((function(e){e.addEventListener("click",(function(){return o()}))})),h.querySelector(".profile__edit-button").addEventListener("click",(function(){w.value=O.textContent,U.value=P.textContent,y(B,L,F),n(g)})),h.querySelector(".profile__add-button").addEventListener("click",(function(){y(I,A,F),n(k)})),S.forEach((function(e){e.addEventListener("click",r)})),h.querySelector(".profile__avatar-button").addEventListener("click",(function(){y(J,x,F),n(E)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){e.addEventListener("submit",(function(e){e.preventDefault(),_(o,n)}));var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){(function(e,t,n){e.validity.valid?d(e,t,n):function(e,t,n){var o=f(e,t);e.classList.add(n.inputErrorClass),o.classList.add(n.errorClass),o.textContent=e.validationMessage}(e,t,n)})(r,e,t),_(o,n)}))})),_(o,n)}(t,e)}))}(F)})();